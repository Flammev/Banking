<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Rift Pay - {{ title }}">
    <meta name="theme-color" content="#0f172a">
    <title>{{ title }} - Rift Pay</title>
    {% load static currency_filters %}
    <link rel="stylesheet" href="{% static 'transfer.css' %}?v=2">
</head>
<body>
    <div class="app">
        <!-- ‚îÄ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ‚îÄ -->
        <header class="topbar">
            <div class="topbar-inner">
                <div class="brand">Rift<span>Pay</span></div>
                <nav class="nav">
                    <a href="{% url 'home' %}" class="nav-link">Dashboard</a>
                    <a href="{% url 'transfer' %}" class="nav-link">Transfert</a>
                    <a href="{% url 'deposit' %}" class="nav-link {% if operation == 'deposit' %}active{% endif %}">D√©p√¥t</a>
                    <a href="{% url 'withdraw' %}" class="nav-link {% if operation == 'withdraw' %}active{% endif %}">Retrait</a>
                    <a href="{% url 'history' %}" class="nav-link">Historique</a>
                </nav>
                <a href="{% url 'logout' %}" class="logout-btn" title="D√©connexion">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </a>
            </div>
        </header>

        <!-- ‚îÄ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ‚îÄ -->
        <main class="main">
            <div class="transfer-card">
                <div class="transfer-header">
                    <h1>{{ title }}</h1>
                    <p>{{ subtitle }}</p>
                </div>

                <form method="POST" action="{% url 'process_mobile_money' %}" class="transfer-form">
                    {% csrf_token %}
                    <input type="hidden" name="operation" value="{{ operation }}">
                    <input type="hidden" name="next_view" value="{{ next_view }}">

                    <!-- Flash messages -->
                    {% if message %}
                        <div class="alert alert-success" data-message="success">
                            <strong>Succ√®s !</strong> {{ message }}
                        </div>
                    {% endif %}
                    {% if error %}
                        <div class="alert alert-error" data-message="error">
                            <strong>Erreur !</strong> {{ error }}
                        </div>
                    {% endif %}

                    <!-- Operator -->
                    <div class="form-group">
                        <label class="form-label">Op√©rateur</label>
                        <div class="lookup-tabs" style="grid-template-columns: 1fr 1fr;">
                            <button type="button" class="lookup-tab active" data-operator="ORANGE">
                                <span class="tab-icon">üüß</span>
                                <span>Orange</span>
                            </button>
                            <button type="button" class="lookup-tab" data-operator="MTN">
                                <span class="tab-icon">üü®</span>
                                <span>MTN</span>
                            </button>
                        </div>
                        <input type="hidden" id="operator" name="operator" value="ORANGE">
                    </div>

                    <!-- Phone number -->
                    <div class="form-group">
                        <label for="phone_number" class="form-label">Num√©ro de t√©l√©phone</label>
                        <div class="input-wrapper">
                            <span class="input-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>
                            </span>
                            <input type="tel" id="phone_number" name="phone_number" required class="form-input" placeholder="Ex: 237 6XX XXX XXX"
                                   pattern="\+?[\d\s\-\(\)]{8,20}"
                                   title="Enter a valid phone number (8‚Äì20 characters, digits, spaces, hyphens, parentheses)"
                                   maxlength="20">
                        </div>
                        <small class="form-hint">Num√©ro valide de l'op√©rateur s√©lectionn√©</small>
                    </div>

                    <!-- Amount -->
                    <div class="form-group">
                        <label for="amount" class="form-label">Montant</label>
                        <div class="input-wrapper">
                            <span class="input-icon currency">F</span>
                            <input type="number" id="amount" name="amount" required step="0.01" min="0.01" class="form-input amount-input" placeholder="0.00">
                        </div>
                        <small class="form-hint">Maximum par op√©ration : 5 000 000 FCFA</small>
                    </div>

                    <!-- Balance -->
                    <div class="balance-banner">
                        <small>Solde disponible</small>
                        <strong>{{ available_balance|default:0|fcfa }}</strong>
                    </div>

                    <!-- Buttons -->
                    <div class="btn-row">
                        <button type="submit" class="btn btn--primary">{{ submit_label }}</button>
                        <a href="{% url 'home' %}" class="btn btn--ghost" style="text-decoration:none;">Annuler</a>
                    </div>

                    <div class="back-link">
                        <a href="{% url 'home' %}">‚Üê Retour au Dashboard</a>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // Operator tabs
        const operatorInput = document.getElementById('operator');
        const tabs = document.querySelectorAll('.lookup-tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', e => {
                e.preventDefault();
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                operatorInput.value = tab.getAttribute('data-operator');
            });
        });

        // Auto-dismiss alerts
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-message]').forEach(m =>
                setTimeout(() => m.style.display = 'none', 5000)
            );
        });
    </script>
</body>
</html>
